<!--
  æ–‡ä»¶å: set_ctrl.launch
  åŠŸèƒ½æè¿°: unitree_controlleråŒ…çš„æ§åˆ¶å™¨å‚æ•°è®¾ç½®å¯åŠ¨æ–‡ä»¶
  
  ä¸»è¦ä½œç”¨:
  1. è®¾ç½®æœºå™¨äººåç§°å‚æ•°ï¼Œæ”¯æŒå¤šç§æœºå™¨äººå‹å·
  2. ä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›ç»Ÿä¸€çš„æœºå™¨äººæ ‡è¯†é…ç½®
  3. è¢«å…¶ä»–launchæ–‡ä»¶å¼•ç”¨ï¼Œå®ç°å‚æ•°åŒ–å¯åŠ¨
  4. å¯é€‰æ‹©æ€§å¯åŠ¨unitree_servoèŠ‚ç‚¹
  
  åœ¨æ•´ä¸ªé¡¹ç›®ä¸­çš„ä½œç”¨:
  - ğŸŸ¡ é…ç½®æ–‡ä»¶ - ä¸ºç³»ç»Ÿæä¾›æœºå™¨äººå‹å·å‚æ•°
  - è¢«gazebo_move_base.launchç­‰ä¸Šå±‚å¯åŠ¨æ–‡ä»¶å¼•ç”¨
  - æ”¯æŒgo1, a1, laikago, aliengoç­‰å¤šç§æœºå™¨äººå‹å·
  - å®ç°ä¸€å¥—ä»£ç æ”¯æŒå¤šç§æœºå™¨äººçš„çµæ´»é…ç½®
  
  ä½¿ç”¨åœºæ™¯:
  - é€šå¸¸ä¸ç›´æ¥å¯åŠ¨ï¼Œè€Œæ˜¯è¢«å…¶ä»–launchæ–‡ä»¶åŒ…å«
  - æä¾›æœºå™¨äººåç§°çš„ç»Ÿä¸€é…ç½®å…¥å£
  - æ”¯æŒè¿è¡Œæ—¶å‚æ•°ä¼ é€’å’Œè¦†ç›–
  
  å‚æ•°ä¼ é€’ç¤ºä¾‹:
  <include file="$(find unitree_controller)/launch/set_ctrl.launch">
      <arg name="rname" value="go1"/>
  </include>
-->

<launch>
    
    <!-- ==================== å‚æ•°å®šä¹‰å’Œè®¾ç½® ==================== -->
    
    <!--
      æœºå™¨äººåç§°å‚æ•°å£°æ˜
      
      å‚æ•°å: rname (robot nameçš„ç¼©å†™)
      é»˜è®¤å€¼: laikago
      æ•°æ®ç±»å‹: å­—ç¬¦ä¸²
      
      æ”¯æŒçš„æœºå™¨äººå‹å·:
      - laikago: Unitreeæ—©æœŸå››è¶³æœºå™¨äººå‹å·
      - a1: Unitree A1æœºå™¨äºº
      - go1: Unitree Go1æœºå™¨äºº  
      - aliengo: Unitree Aliengoæœºå™¨äºº
      - go2: Unitree Go2æœºå™¨äºº(è¾ƒæ–°å‹å·)
      
      ä½œç”¨:
      - ä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›æœºå™¨äººå‹å·æ ‡è¯†
      - ç”¨äºåŠ è½½å¯¹åº”çš„URDFæ¨¡å‹å’Œé…ç½®æ–‡ä»¶
      - å½±å“è¯é¢˜å‘½åå’ŒGazeboæ¨¡å‹åç§°
      
      å‘½åçº¦å®š:
      - åœ¨Gazeboä¸­æœºå™¨äººæ¨¡å‹åä¸º: {rname}_gazebo
      - ç›¸å…³è¯é¢˜å‰ç¼€ä¸º: /{rname}_gazebo/
      - URDFæè¿°åŒ…åä¸º: {rname}_description
    -->
    <arg name="rname" default="laikago"/>
    
    <!--
      è®¾ç½®å…¨å±€ROSå‚æ•°
      
      å‚æ•°è·¯å¾„: /robot_name
      å‚æ•°å€¼: $(arg rname) - å¼•ç”¨ä¸Šé¢å®šä¹‰çš„rnameå‚æ•°
      ä½œç”¨åŸŸ: å…¨å±€ (æ‰€æœ‰èŠ‚ç‚¹éƒ½å¯ä»¥è®¿é—®)
      
      é‡è¦æ€§:
      - ğŸ”´ æ ¸å¿ƒå‚æ•° - æ•´ä¸ªç³»ç»Ÿçš„æœºå™¨äººå‹å·æ ‡è¯†
      - è¢«unitree_controlleråŒ…ä¸­çš„æ‰€æœ‰ç¨‹åºè¯»å–
      - å½±å“è¯é¢˜å‘½åã€æ¨¡å‹åŠ è½½ã€é…ç½®æ–‡ä»¶é€‰æ‹©ç­‰
      
      ä½¿ç”¨æ–¹å¼:
      - C++ä¸­é€šè¿‡ ros::param::get("/robot_name", robot_name) è·å–
      - Pythonä¸­é€šè¿‡ rospy.get_param("/robot_name") è·å–
      - å‘½ä»¤è¡Œé€šè¿‡ rosparam get /robot_name æŸ¥çœ‹
      
      å‚æ•°ä¼ æ’­:
      - æ­¤å‚æ•°è®¾ç½®åï¼Œæ‰€æœ‰ç›¸å…³èŠ‚ç‚¹éƒ½ä½¿ç”¨ç»Ÿä¸€çš„æœºå™¨äººåç§°
      - ç¡®ä¿è¯é¢˜å‘½åçš„ä¸€è‡´æ€§å’Œç³»ç»Ÿçš„åè°ƒæ€§
    -->
    <param name="robot_name" value="$(arg rname)"/>

    <!-- ==================== å¯é€‰èŠ‚ç‚¹å¯åŠ¨ ==================== -->
    
    <!--
      unitree_servoèŠ‚ç‚¹å¯åŠ¨ (å½“å‰å·²æ³¨é‡Š)
      
      åŒ…å: unitree_controller
      èŠ‚ç‚¹ç±»å‹: unitree_servo (å¯¹åº”src/servo.cppç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶)
      èŠ‚ç‚¹åç§°: unitree_servo
      é‡å¯ç­–ç•¥: respawn="true" (èŠ‚ç‚¹å´©æºƒæ—¶è‡ªåŠ¨é‡å¯)
      
      åŠŸèƒ½è¯´æ˜:
      - è¿™æ˜¯æœºå™¨äººçš„ä¸»æ§åˆ¶èŠ‚ç‚¹
      - è´Ÿè´£è®©æœºå™¨äººä»å¹³èººçŠ¶æ€ç«™ç«‹èµ·æ¥
      - å®ç°å…³èŠ‚æ§åˆ¶å’ŒçŠ¶æ€ç›‘æ§
      - è¿æ¥Gazeboä»¿çœŸä¸ROSæ§åˆ¶ç³»ç»Ÿ
      
      æ³¨é‡ŠåŸå› :
      - é€šå¸¸å¸Œæœ›æ‰‹åŠ¨å¯åŠ¨æ§åˆ¶èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨å¯åŠ¨
      - ä¾¿äºè°ƒè¯•å’Œæµ‹è¯•ï¼Œå¯ä»¥æŒ‰éœ€å¯åŠ¨
      - é¿å…åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å°±å¼€å§‹æ§åˆ¶æœºå™¨äºº
      
      å¦‚æœéœ€è¦è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Š:
      <node pkg="unitree_controller" type="unitree_servo" name="unitree_servo" respawn="true"/>
      
      æ‰‹åŠ¨å¯åŠ¨æ–¹å¼:
      rosrun unitree_controller unitree_servo
      
      å¯åŠ¨æ—¶æœº:
      1. å…ˆå¯åŠ¨Gazeboä»¿çœŸç¯å¢ƒ
      2. åŠ è½½æœºå™¨äººæ¨¡å‹å’Œæ§åˆ¶å™¨
      3. æœ€åå¯åŠ¨unitree_servoè®©æœºå™¨äººç«™ç«‹
    -->
    <!-- <node pkg="unitree_controller" type="unitree_servo" name="unitree_servo" respawn="true"/> -->

</launch>

<!--
  ==================== ä½¿ç”¨ç¤ºä¾‹å’Œé›†æˆè¯´æ˜ ====================
  
  1. è¢«å…¶ä»–launchæ–‡ä»¶å¼•ç”¨çš„å…¸å‹æ–¹å¼:
  
        /**
         * æœºå™¨äººåæ ‡ç³»æ¨¡å¼ä¸»å¾ªç¯
         * 
         * è¿åŠ¨ç‰¹æ€§:
         * - ç›´çº¿è¿åŠ¨: ä»¥æ’å®šé€Ÿåº¦å‰è¿›
         * - é«˜åº¦å˜åŒ–: æŒç»­ä¸Šå‡
         * - å§¿æ€ä¿æŒ: ä¸æ—‹è½¬ï¼Œä¿æŒåˆå§‹æœå‘
         * - åæ ‡ç³»: ç›¸å¯¹äºæœºå™¨äººæœ¬ä½“
         * 
         * åº”ç”¨åœºæ™¯:
         * - æµ‹è¯•æœºå™¨äººæœ¬ä½“åæ ‡ç³»ä¸‹çš„è¿åŠ¨æ§åˆ¶
         * - éªŒè¯é‡Œç¨‹è®¡å’Œæƒ¯æ€§å¯¼èˆªçš„å‡†ç¡®æ€§
         * - æ¨¡æ‹Ÿæœºå™¨äººåœ¨å€¾æ–œé¢æˆ–è¿åŠ¨å¹³å°ä¸Šçš„è¡Œä¸º
         * 
         * æ³¨æ„äº‹é¡¹:
         * - æœºå™¨äººä¼šæŒç»­ä¸Šå‡ï¼Œæ³¨æ„ä»¿çœŸç¯å¢ƒçš„è¾¹ç•Œ
         * - é€Ÿåº¦å€¼è¾ƒå°ï¼Œé€‚åˆç²¾ç¡®çš„ä¼ æ„Ÿå™¨æµ‹è¯•
         * - å¯ä»¥é€šè¿‡ä¿®æ”¹def_frameå¹¶é‡æ–°ç¼–è¯‘æ¥åˆ‡æ¢æ¨¡å¼
         */
        while (ros::ok())
        {
            // å‘å¸ƒæœºå™¨äººé€Ÿåº¦å‘½ä»¤åˆ°Gazebo
            move_publisher.publish(model_state_pub);
            
            // ç­‰å¾…ä¸‹ä¸€ä¸ªæ§åˆ¶å‘¨æœŸ
            loop_rate.sleep();
        }
    }
    
    // ==================== ç¨‹åºæ­£å¸¸é€€å‡º ====================
    
    /**
     * ç¨‹åºç»“æŸ
     * 
     * æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨æ”¶åˆ°SIGINTä¿¡å·(Ctrl+C)æˆ–ros::shutdown()æ—¶æ‰ä¼šåˆ°è¾¾è¿™é‡Œ
     * ç¨‹åºé€€å‡ºæ—¶ï¼Œæœºå™¨äººå°†ä¿æŒæœ€åçš„çŠ¶æ€
     */
    return 0;
}

// ==================== ä½¿ç”¨è¯´æ˜å’Œæ‰©å±•å»ºè®® ====================

/*
 * ä½¿ç”¨æ–¹æ³•:
 * 
 * 1. å¯åŠ¨Gazeboä»¿çœŸç¯å¢ƒ:
 *    roslaunch unitree_gazebo normal.launch rname:=go1 wname:=earth
 * 
 * 2. è¿è¡Œä½ç½®æ§åˆ¶å™¨:
 *    rosrun unitree_controller unitree_move_kinetic
 * 
 * 3. è§‚å¯Ÿæœºå™¨äººè¿åŠ¨:
 *    - ä¸–ç•Œåæ ‡ç³»æ¨¡å¼: æœºå™¨äººç»•åŸç‚¹åšåœ†å‘¨è¿åŠ¨
 *    - æœºå™¨äººåæ ‡ç³»æ¨¡å¼: æœºå™¨äººç›´çº¿å‰è¿›å¹¶ä¸Šå‡
 * 
 * æ¨¡å¼åˆ‡æ¢:
 * 1. ä¿®æ”¹ def_frame = coord::ROBOT
 * 2. é‡æ–°ç¼–è¯‘: catkin_make
 * 3. è¿è¡Œç¨‹åºè§‚å¯Ÿä¸åŒçš„è¿åŠ¨æ¨¡å¼
 * 
 * æ‰©å±•å»ºè®®:
 * 
 * 1. æ·»åŠ é”®ç›˜æ§åˆ¶:
 *    - å®ç°äº¤äº’å¼ä½ç½®æ§åˆ¶
 *    - æ”¯æŒå®æ—¶è°ƒæ•´è¿åŠ¨å‚æ•°
 * 
 * 2. æ·»åŠ è½¨è¿¹æ–‡ä»¶è¯»å–:
 *    - ä»æ–‡ä»¶åŠ è½½é¢„å®šä¹‰è½¨è¿¹
 *    - æ”¯æŒå¤æ‚çš„è¿åŠ¨æ¨¡å¼
 * 
 * 3. æ·»åŠ ä¼ æ„Ÿå™¨æ•°æ®è®°å½•:
 *    - è®°å½•è¿åŠ¨è¿‡ç¨‹ä¸­çš„ä¼ æ„Ÿå™¨æ•°æ®
 *    - ç”¨äºç®—æ³•éªŒè¯å’Œæ•°æ®é›†æ„å»º
 * 
 * 4. æ·»åŠ è¿åŠ¨å‚æ•°é…ç½®:
 *    - é€šè¿‡ROSå‚æ•°åŠ¨æ€é…ç½®é€Ÿåº¦ã€åŠå¾„ç­‰
 *    - æ— éœ€é‡æ–°ç¼–è¯‘å³å¯è°ƒæ•´è¿åŠ¨æ¨¡å¼
 * 
 * ä»£ç ç¤ºä¾‹ - æ·»åŠ å‚æ•°åŒ–é…ç½®:
 * 
 * double radius, period, linear_x, linear_z;
 * nh.param("circle_radius", radius, 1.5);
 * nh.param("circle_period", period, 5000.0);
 * nh.param("linear_speed_x", linear_x, 0.02);
 * nh.param("linear_speed_z", linear_z, 0.08);
 * 
 * æ€§èƒ½ä¼˜åŒ–å»ºè®®:
 * 
 * 1. é™ä½å‘å¸ƒé¢‘ç‡:
 *    - å¯¹äºè½¨è¿¹è·Ÿè¸ªï¼Œ1000Hzå¯èƒ½è¿‡é«˜
 *    - å¯ä»¥é™ä½åˆ°100Hzæˆ–æ›´ä½ï¼Œå‡å°‘ç³»ç»Ÿè´Ÿè½½
 * 
 * 2. æ·»åŠ å¹³æ»‘è¿‡æ¸¡:
 *    - åœ¨è¿åŠ¨å¼€å§‹å’Œç»“æŸæ—¶æ·»åŠ åŠ é€Ÿåº¦é™åˆ¶
 *    - é¿å…çªç„¶çš„é€Ÿåº¦å˜åŒ–
 * 
 * å®‰å…¨æ³¨æ„äº‹é¡¹:
 * 
 * 1. ç›‘æ§æœºå™¨äººçŠ¶æ€:
 *    - ç¡®ä¿æœºå™¨äººä¸ä¼šç§»åŠ¨åˆ°å±é™©ä½ç½®
 *    - è®¾ç½®ä½ç½®å’Œé€Ÿåº¦é™åˆ¶
 * 
 * 2. ç´§æ€¥åœæ­¢:
 *    - å®ç°Ctrl+Cå®‰å…¨é€€å‡º
 *    - åœ¨å¼‚å¸¸æƒ…å†µä¸‹è‡ªåŠ¨åœæ­¢è¿åŠ¨
 * 
 * è°ƒè¯•æŠ€å·§:
 * 
 * 1. ä½¿ç”¨rvizå¯è§†åŒ–:
 *    - æ˜¾ç¤ºæœºå™¨äººè½¨è¿¹å’Œç›®æ ‡ä½ç½®
 *    - ç›‘æ§åæ ‡å˜æ¢å…³ç³»
 * 
 * 2. æ·»åŠ æ—¥å¿—è¾“å‡º:
 *    - è®°å½•å…³é”®çš„ä½ç½®å’Œé€Ÿåº¦ä¿¡æ¯
 *    - ä¾¿äºé—®é¢˜è¯Šæ–­å’Œæ€§èƒ½åˆ†æ
 */

<!--
  ==================== ä½¿ç”¨ç¤ºä¾‹å’Œé›†æˆè¯´æ˜ ====================
  
  1. è¢«å…¶ä»–launchæ–‡ä»¶å¼•ç”¨çš„å…¸å‹æ–¹å¼:
  
  <include file="$(find unitree_controller)/launch/set_ctrl.launch">
      <arg name="rname" value="go1"/>
  </include>
  
  è¿™æ ·å¯ä»¥å°†æœºå™¨äººåç§°å‚æ•°ä¼ é€’ç»™unitree_controlleråŒ…
  
  2. åœ¨gazebo_move_base.launchä¸­çš„å®é™…ä½¿ç”¨:
  
  <include file="$(find unitree_controller)/launch/set_ctrl.launch">
      <arg name="rname" value="$(arg rname)"/>
  </include>
  
  è¿™é‡Œ$(arg rname)æ˜¯ä»ä¸Šå±‚launchæ–‡ä»¶ä¼ é€’ä¸‹æ¥çš„å‚æ•°
  
  3. å‘½ä»¤è¡Œå¯åŠ¨æ—¶æŒ‡å®šæœºå™¨äººç±»å‹:
  
  roslaunch unitree_gazebo normal.launch rname:=go1
  
  è¿™ä¸ªrnameå‚æ•°ä¼šå±‚å±‚ä¼ é€’ï¼Œæœ€ç»ˆè®¾ç½®åˆ°/robot_nameå…¨å±€å‚æ•°
  
  ==================== å‚æ•°ä¼ é€’é“¾è·¯ ====================
  
  å‘½ä»¤è¡Œå‚æ•° -> normal.launch -> set_ctrl.launch -> /robot_nameå‚æ•°
  
  ä¾‹å¦‚:
  1. å‘½ä»¤è¡Œ: roslaunch unitree_gazebo normal.launch rname:=go1
  2. normal.launchæ¥æ”¶rnameå‚æ•°å¹¶ä¼ é€’ç»™set_ctrl.launch
  3. set_ctrl.launchå°†rnameè®¾ç½®ä¸ºå…¨å±€å‚æ•°/robot_name
  4. æ‰€æœ‰ç¨‹åºé€šè¿‡ros::param::get("/robot_name")è·å–æœºå™¨äººç±»å‹
  
  ==================== æ‰©å±•é…ç½®å»ºè®® ====================
  
  1. æ·»åŠ æ›´å¤šæœºå™¨äººå‚æ•°:
  
  <arg name="robot_type" default="quadruped"/>
  <arg name="control_mode" default="position"/>
  <param name="robot_type" value="$(arg robot_type)"/>
  <param name="control_mode" value="$(arg control_mode)"/>
  
  2. æ·»åŠ æ¡ä»¶å¯åŠ¨:
  
  <group if="$(arg auto_start_servo)">
      <node pkg="unitree_controller" type="unitree_servo" name="unitree_servo" respawn="true"/>
  </group>
  
  3. æ·»åŠ å‘½åç©ºé—´æ”¯æŒ:
  
  <group ns="$(arg robot_namespace)">
      <param name="robot_name" value="$(arg rname)"/>
  </group>
  
  ==================== æ•…éšœæ’é™¤ ====================
  
  1. æœºå™¨äººåç§°ä¸åŒ¹é…:
     æ£€æŸ¥: rosparam get /robot_name
     ç¡®ä¿ä¸launchæ–‡ä»¶ä¸­çš„rnameå‚æ•°ä¸€è‡´
  
  2. è¯é¢˜åç§°é”™è¯¯:
     æ£€æŸ¥: rostopic list | grep gazebo
     åº”è¯¥çœ‹åˆ°ç±»ä¼¼ /go1_gazebo/joint_states çš„è¯é¢˜
  
  3. å‚æ•°ä¼ é€’å¤±è´¥:
     ä½¿ç”¨: rosparam list
     ç¡®è®¤ /robot_name å‚æ•°å·²æ­£ç¡®è®¾ç½®
-->

</launch>