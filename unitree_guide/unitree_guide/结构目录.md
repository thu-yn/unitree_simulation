# unitree_guide/unitree_guide æ–‡ä»¶å¤¹è¯¦ç»†ç»“æ„

## ğŸ“ æ€»ä½“ç›®å½•ç»“æ„
```
unitree_guide/unitree_guide/
â”œâ”€â”€ ğŸ“ include/                         # å¤´æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ FSM/                         # æœ‰é™çŠ¶æ€æœºæ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“ control/                     # æ§åˆ¶ç»„ä»¶æ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“ Gait/                        # æ­¥æ€ç”Ÿæˆæ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“ interface/                   # æ¥å£æ¨¡å—
â”‚   â”œâ”€â”€ ğŸ“ message/                     # æ¶ˆæ¯å®šä¹‰æ¨¡å—
â”‚   â””â”€â”€ ğŸ“ common/                      # é€šç”¨å·¥å…·æ¨¡å—
â”œâ”€â”€ ğŸ“ src/                             # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ FSM/                         # çŠ¶æ€æœºå®ç°æºç 
â”‚   â”œâ”€â”€ ğŸ“ control/                     # æ§åˆ¶ç»„ä»¶å®ç°æºç 
â”‚   â”œâ”€â”€ ğŸ“ Gait/                        # æ­¥æ€ç”Ÿæˆå®ç°æºç 
â”‚   â”œâ”€â”€ ğŸ“ interface/                   # æ¥å£å®ç°æºç 
â”‚   â”œâ”€â”€ ğŸ“ message/                     # æ¶ˆæ¯å®ç°æºç 
â”‚   â”œâ”€â”€ ğŸ“ common/                      # é€šç”¨å·¥å…·å®ç°æºç 
â”‚   â””â”€â”€ ğŸ“„ main.cpp                     # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ ğŸ“ library/                         # ä¾èµ–åº“ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ unitree_legged_sdk_3.2/      # SDKç‰ˆæœ¬3.2
â”‚   â”œâ”€â”€ ğŸ“ unitree_legged_sdk_3.4/      # SDKç‰ˆæœ¬3.4
â”‚   â””â”€â”€ ğŸ“ unitree_legged_sdk-3.8.0/    # SDKç‰ˆæœ¬3.8
â”œâ”€â”€ ğŸ“ launch/                          # ROSå¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ CMakeLists.txt                   # CMakeæ„å»ºé…ç½®
â””â”€â”€ ğŸ“„ package.xml                      # ROSåŒ…é…ç½®æ–‡ä»¶
```

## ğŸ“‚ 1. include/ ç›®å½•è¯¦ç»†ç»“æ„

### ğŸ”§ FSM/ (æœ‰é™çŠ¶æ€æœº)
```
include/FSM/
â”œâ”€â”€ ğŸ“„ FSM.h                           # çŠ¶æ€æœºä¸»æ§åˆ¶å™¨
â”œâ”€â”€ ğŸ“„ FSMState.h                      # çŠ¶æ€åŸºç±»å®šä¹‰
â”œâ”€â”€ ğŸ“„ State_Passive.h                 # è¢«åŠ¨çŠ¶æ€ï¼ˆåˆå§‹çŠ¶æ€ï¼‰
â”œâ”€â”€ ğŸ“„ State_FixedStand.h              # å›ºå®šç«™ç«‹çŠ¶æ€
â”œâ”€â”€ ğŸ“„ State_FreeStand.h               # è‡ªç”±ç«™ç«‹çŠ¶æ€
â”œâ”€â”€ ğŸ“„ State_Trotting.h                # å°è·‘æ­¥æ€çŠ¶æ€
â”œâ”€â”€ ğŸ“„ State_BalanceTest.h             # å¹³è¡¡æµ‹è¯•çŠ¶æ€
â”œâ”€â”€ ğŸ“„ State_SwingTest.h               # æ‘†åŠ¨æµ‹è¯•çŠ¶æ€
â”œâ”€â”€ ğŸ“„ State_StepTest.h                # æ­¥ä¼æµ‹è¯•çŠ¶æ€
â””â”€â”€ ğŸ“„ State_move_base.h               # ç§»åŠ¨åŸºåº§çŠ¶æ€ï¼ˆå¯é€‰ç¼–è¯‘ï¼‰
```

**æ ¸å¿ƒçŠ¶æ€ç±»å‹è¯´æ˜**ï¼š
- `PASSIVE` â†’ `FIXEDSTAND` â†’ `TROTTING` ä¸ºä¸»è¦æ§åˆ¶æµç¨‹
- æŒ‰é”®æ§åˆ¶ï¼š'2'é”®è¿›å…¥ç«™ç«‹ï¼Œ'4'é”®è¿›å…¥å°è·‘ï¼Œ'wasd'æ§åˆ¶ç§»åŠ¨

### âš™ï¸ control/ (æ§åˆ¶ç»„ä»¶)
```
include/control/
â”œâ”€â”€ ğŸ“„ CtrlComponents.h                # æ§åˆ¶ç»„ä»¶é›†åˆï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ ğŸ“„ ControlFrame.h                  # ä¸»æ§åˆ¶æ¡†æ¶
â”œâ”€â”€ ğŸ“„ Estimator.h                     # çŠ¶æ€ä¼°è®¡å™¨
â”œâ”€â”€ ğŸ“„ BalanceCtrl.h                   # å¹³è¡¡æ§åˆ¶å™¨
â””â”€â”€ ğŸ“„ DataReader.h                    # æ•°æ®è¯»å–å™¨
```

**CtrlComponentsç»“æ„**ï¼š
```cpp
struct CtrlComponents {
    LowlevelCmd *lowCmd;           // åº•å±‚å‘½ä»¤
    LowlevelState *lowState;       // åº•å±‚çŠ¶æ€
    IOInterface *ioInter;          // IOæ¥å£
    QuadrupedRobot *robotModel;    // æœºå™¨äººæ¨¡å‹
    WaveGenerator *waveGen;        // æ³¢å½¢ç”Ÿæˆå™¨
    Estimator *estimator;          // çŠ¶æ€ä¼°è®¡å™¨
    BalanceCtrl *balCtrl;          // å¹³è¡¡æ§åˆ¶å™¨
    VecInt4 *contact;              // è¶³ç«¯æ¥è§¦çŠ¶æ€
    Vec4 *phase;                   // æ­¥æ€ç›¸ä½
    double dt = 0.002;             // æ§åˆ¶å‘¨æœŸ(500Hz)
};
```

### ğŸš¶ Gait/ (æ­¥æ€ç”Ÿæˆ)
```
include/Gait/
â”œâ”€â”€ ğŸ“„ WaveGenerator.h                 # æ³¢å½¢ç”Ÿæˆå™¨
â”œâ”€â”€ ğŸ“„ GaitGenerator.h                 # æ­¥æ€ç”Ÿæˆå™¨
â””â”€â”€ ğŸ“„ Bezier.h                        # è´å¡å°”æ›²çº¿å·¥å…·
```

**é¢„è®¾æ­¥æ€å‚æ•°**ï¼š
```cpp
// å°è·‘æ­¥æ€ (é»˜è®¤)
WaveGenerator(0.45, 0.5, Vec4(0, 0.5, 0.5, 0));
// çˆ¬è¡Œæ­¥æ€
WaveGenerator(1.1, 0.75, Vec4(0, 0.25, 0.5, 0.75));
// è·³è·ƒæ­¥æ€
WaveGenerator(0.4, 0.7, Vec4(0, 0, 0, 0));
```

### ğŸ”Œ interface/ (æ¥å£æ¨¡å—)
```
include/interface/
â”œâ”€â”€ ğŸ“„ IOInterface.h                   # æŠ½è±¡IOæ¥å£åŸºç±»
â”œâ”€â”€ ğŸ“„ IOROS.h                         # ROS/Gazeboä»¿çœŸæ¥å£
â”œâ”€â”€ ğŸ“„ IOSDK.h                         # çœŸå®æœºå™¨äººSDKæ¥å£
â”œâ”€â”€ ğŸ“„ CmdPanel.h                      # å‘½ä»¤é¢æ¿
â””â”€â”€ ğŸ“„ KeyBoard.h                      # é”®ç›˜è¾“å…¥å¤„ç†
```

**æ¥å£å±‚æ¬¡ç»“æ„**ï¼š
```
IOInterface (åŸºç±»)
â”œâ”€â”€ IOROS     (ä»¿çœŸç¯å¢ƒæ¥å£)
â””â”€â”€ IOSDK     (çœŸå®æœºå™¨äººæ¥å£)
```

### ğŸ“¨ message/ (æ¶ˆæ¯å®šä¹‰)
```
include/message/
â”œâ”€â”€ ğŸ“„ LowlevelCmd.h                   # åº•å±‚æ§åˆ¶å‘½ä»¤
â”œâ”€â”€ ğŸ“„ LowlevelState.h                 # åº•å±‚çŠ¶æ€åé¦ˆ
â””â”€â”€ ğŸ“„ unitree_joystick.h              # æ‰‹æŸ„æ¶ˆæ¯å®šä¹‰
```

### ğŸ› ï¸ common/ (é€šç”¨å·¥å…·)
```
include/common/
â”œâ”€â”€ ğŸ“„ enumClass.h                     # æšä¸¾ç±»å®šä¹‰
â”œâ”€â”€ ğŸ“„ mathTypes.h                     # æ•°å­¦ç±»å‹å®šä¹‰
â”œâ”€â”€ ğŸ“„ mathTools.h                     # æ•°å­¦å·¥å…·å‡½æ•°
â”œâ”€â”€ ğŸ“„ timeMarker.h                    # æ—¶é—´æ ‡è®°å·¥å…·
â”œâ”€â”€ ğŸ“„ unitreeRobot.h                  # æœºå™¨äººæ¨¡å‹å®šä¹‰
â”œâ”€â”€ ğŸ“„ filter.h                        # æ»¤æ³¢å™¨å·¥å…·
â””â”€â”€ ğŸ“„ PyPlot.h                        # Pythonç»˜å›¾æ¥å£ï¼ˆè°ƒè¯•ç”¨ï¼‰
```

## ğŸ“‚ 2. src/ ç›®å½•è¯¦ç»†ç»“æ„

### çŠ¶æ€æœºå®ç°
```
src/FSM/
â”œâ”€â”€ ğŸ“„ FSM.cpp                         # çŠ¶æ€æœºä¸»æ§åˆ¶å™¨å®ç°
â”œâ”€â”€ ğŸ“„ FSMState.cpp                    # çŠ¶æ€åŸºç±»å®ç°
â”œâ”€â”€ ğŸ“„ State_Passive.cpp               # è¢«åŠ¨çŠ¶æ€å®ç°
â”œâ”€â”€ ğŸ“„ State_FixedStand.cpp            # å›ºå®šç«™ç«‹å®ç°
â”œâ”€â”€ ğŸ“„ State_FreeStand.cpp             # è‡ªç”±ç«™ç«‹å®ç°
â”œâ”€â”€ ğŸ“„ State_Trotting.cpp              # å°è·‘æ­¥æ€å®ç°
â”œâ”€â”€ ğŸ“„ State_BalanceTest.cpp           # å¹³è¡¡æµ‹è¯•å®ç°
â”œâ”€â”€ ğŸ“„ State_SwingTest.cpp             # æ‘†åŠ¨æµ‹è¯•å®ç°
â”œâ”€â”€ ğŸ“„ State_StepTest.cpp              # æ­¥ä¼æµ‹è¯•å®ç°
â””â”€â”€ ğŸ“„ State_move_base.cpp             # ç§»åŠ¨åŸºåº§å®ç°
```

### æ§åˆ¶ç»„ä»¶å®ç°
```
src/control/
â”œâ”€â”€ ğŸ“„ ControlFrame.cpp                # ä¸»æ§åˆ¶æ¡†æ¶å®ç°
â”œâ”€â”€ ğŸ“„ Estimator.cpp                   # çŠ¶æ€ä¼°è®¡å™¨å®ç°
â”œâ”€â”€ ğŸ“„ BalanceCtrl.cpp                 # å¹³è¡¡æ§åˆ¶å™¨å®ç°
â””â”€â”€ ğŸ“„ DataReader.cpp                  # æ•°æ®è¯»å–å™¨å®ç°
```

### æ­¥æ€ç”Ÿæˆå®ç°
```
src/Gait/
â”œâ”€â”€ ğŸ“„ WaveGenerator.cpp               # æ³¢å½¢ç”Ÿæˆå™¨å®ç°
â”œâ”€â”€ ğŸ“„ GaitGenerator.cpp               # æ­¥æ€ç”Ÿæˆå™¨å®ç°
â””â”€â”€ ğŸ“„ Bezier.cpp                      # è´å¡å°”æ›²çº¿å®ç°
```

### æ¥å£å®ç°
```
src/interface/
â”œâ”€â”€ ğŸ“„ IOROS.cpp                       # ROSæ¥å£å®ç°
â”œâ”€â”€ ğŸ“„ IOSDK.cpp                       # SDKæ¥å£å®ç°
â”œâ”€â”€ ğŸ“„ CmdPanel.cpp                    # å‘½ä»¤é¢æ¿å®ç°
â””â”€â”€ ğŸ“„ KeyBoard.cpp                    # é”®ç›˜è¾“å…¥å®ç°
```

### æ¶ˆæ¯å®ç°
```
src/message/
â”œâ”€â”€ ğŸ“„ LowlevelCmd.cpp                 # åº•å±‚å‘½ä»¤å®ç°
â””â”€â”€ ğŸ“„ LowlevelState.cpp               # åº•å±‚çŠ¶æ€å®ç°
```

### é€šç”¨å·¥å…·å®ç°
```
src/common/
â”œâ”€â”€ ğŸ“„ mathTools.cpp                   # æ•°å­¦å·¥å…·å®ç°
â”œâ”€â”€ ğŸ“„ timeMarker.cpp                  # æ—¶é—´æ ‡è®°å®ç°
â”œâ”€â”€ ğŸ“„ unitreeRobot.cpp                # æœºå™¨äººæ¨¡å‹å®ç°
â”œâ”€â”€ ğŸ“„ filter.cpp                      # æ»¤æ³¢å™¨å®ç°
â””â”€â”€ ğŸ“„ PyPlot.cpp                      # Pythonç»˜å›¾å®ç°
```

### ğŸ¯ ä¸»ç¨‹åº
```
src/
â””â”€â”€ ğŸ“„ main.cpp                        # ä¸»ç¨‹åºå…¥å£æ–‡ä»¶
```

**main.cpp ä¸»è¦æµç¨‹**ï¼š
```cpp
1. è®¾ç½®å®æ—¶è¿›ç¨‹è°ƒåº¦ (SCHED_FIFO)
2. åˆå§‹åŒ–ROSèŠ‚ç‚¹ (å¦‚æœå¯ç”¨)
3. åˆ›å»ºIOæ¥å£ (IOROS/IOSDK)
4. åˆå§‹åŒ–æ§åˆ¶ç»„ä»¶ (CtrlComponents)
5. é…ç½®æœºå™¨äººæ¨¡å‹ (A1/Go1)
6. è®¾ç½®æ­¥æ€ç”Ÿæˆå™¨ (é»˜è®¤Trotæ­¥æ€)
7. åˆ›å»ºæ§åˆ¶æ¡†æ¶ (ControlFrame)
8. 500Hzæ§åˆ¶å¾ªç¯
```

## ğŸ“‚ 3. library/ ç›®å½•ç»“æ„

### SDKç‰ˆæœ¬ç®¡ç†
```
library/
â”œâ”€â”€ ğŸ“ unitree_legged_sdk_3.2/         # SDKç‰ˆæœ¬3.2
â”‚   â”œâ”€â”€ ğŸ“ include/
â”‚   â”‚   â””â”€â”€ ğŸ“ unitree_legged_sdk/
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ unitree_legged_sdk.h
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ comm.h
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ safety.h
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ udp.h
â”‚   â”‚       â””â”€â”€ ğŸ“„ loop.h
â”‚   â””â”€â”€ ğŸ“ lib/
â”œâ”€â”€ ğŸ“ unitree_legged_sdk_3.4/         # SDKç‰ˆæœ¬3.4
â”‚   â””â”€â”€ (ç±»ä¼¼ç»“æ„)
â””â”€â”€ ğŸ“ unitree_legged_sdk-3.8.0/       # SDKç‰ˆæœ¬3.8 (æœ€æ–°)
    â”œâ”€â”€ ğŸ“ include/
    â””â”€â”€ ğŸ“ lib/
        â”œâ”€â”€ ğŸ“ cpp/
        â”‚   â”œâ”€â”€ ğŸ“ amd64/
        â”‚   â””â”€â”€ ğŸ“ arm64/
        â””â”€â”€ ğŸ“ python/
```

## ğŸ“‚ 4. launch/ ç›®å½•ç»“æ„

```
launch/
â”œâ”€â”€ ğŸ“„ gazeboSim.launch                # Gazeboä»¿çœŸå¯åŠ¨
â”œâ”€â”€ ğŸ“„ realRobot.launch                # çœŸå®æœºå™¨äººå¯åŠ¨
â””â”€â”€ ğŸ“„ debug.launch                    # è°ƒè¯•æ¨¡å¼å¯åŠ¨
```

## ğŸ“„ 5. é…ç½®æ–‡ä»¶

### CMakeLists.txt å…³é”®é…ç½®
```cmake
# ç¼–è¯‘é€‰é¡¹æ§åˆ¶
option(COMPILE_WITH_REAL_ROBOT "Compile with real robot" OFF)
option(COMPILE_WITH_ROS "Compile with ROS" ON)
option(COMPILE_WITH_MOVE_BASE "Compile with move_base" OFF)
option(COMPILE_DEBUG "Compile with debug" OFF)

# æœºå™¨äººç±»å‹æ”¯æŒ
option(ROBOT_TYPE_A1 "Robot type A1" OFF)
option(ROBOT_TYPE_Go1 "Robot type Go1" ON)
```

### package.xml ä¾èµ–å…³ç³»
```xml
<depend>unitree_legged_msgs</depend>         <!-- æ ¸å¿ƒæ¶ˆæ¯ä¾èµ– -->
<build_depend>controller_manager</build_depend>
<build_depend>joint_state_controller</build_depend>
<build_depend>robot_state_publisher</build_depend>
<build_depend>roscpp</build_depend>
<build_depend>std_msgs</build_depend>
```

## ğŸ”— 6. æ¨¡å—é—´è€¦åˆå…³ç³»

### å¼ºä¾èµ–å…³ç³»
- **FSMæ¨¡å—** â†” **controlæ¨¡å—**: çŠ¶æ€æœºä¾èµ–æ§åˆ¶ç»„ä»¶
- **controlæ¨¡å—** â†” **interfaceæ¨¡å—**: æ§åˆ¶éœ€è¦IOæ¥å£
- **Gaitæ¨¡å—** â†” **controlæ¨¡å—**: æ­¥æ€ç”Ÿæˆè¢«æ§åˆ¶æ¡†æ¶ä½¿ç”¨

### ç¼–è¯‘æ—¶ä¾èµ–
```
main.cpp 
  â†“ includes
ControlFrame.h
  â†“ includes  
CtrlComponents.h + FSM.h
  â†“ includes
æ‰€æœ‰å­æ¨¡å—å¤´æ–‡ä»¶
```

## ğŸ® 7. è¿è¡Œæ—¶è¡Œä¸º

### æ§åˆ¶é¢‘ç‡
- **ä¸»æ§åˆ¶å¾ªç¯**: 500Hz (dt = 0.002s)
- **FSMçŠ¶æ€æ£€æŸ¥**: æ¯ä¸ªæ§åˆ¶å‘¨æœŸ
- **æ­¥æ€ç”Ÿæˆ**: è¿ç»­ç›¸ä½æ›´æ–°

### çŠ¶æ€è½¬æ¢æµç¨‹
```
å¯åŠ¨ â†’ PASSIVE â†’ FIXEDSTAND â†’ TROTTING â†’ è¿åŠ¨æ§åˆ¶
  â†‘                                         â†“
  â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â† â†
```

### æ•°æ®æµå‘
```
ç”¨æˆ·è¾“å…¥ â†’ CmdPanel â†’ FSM â†’ CtrlComponents â†’ IOInterface â†’ æœºå™¨äºº
                                                  â†“
ä¼ æ„Ÿå™¨æ•°æ® â† LowlevelState â† IOInterface â† â† â† â† â†
```

## ğŸ’¡ å…³é”®è®¾è®¡ç‰¹ç‚¹

1. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„åŠŸèƒ½åˆ†ç¦»å’Œæ¥å£å®šä¹‰
2. **å¤šç‰ˆæœ¬SDKæ”¯æŒ**: å‘åå…¼å®¹ä¸åŒSDKç‰ˆæœ¬
3. **å¤šå¹³å°æ”¯æŒ**: ä»¿çœŸç¯å¢ƒå’ŒçœŸå®æœºå™¨äººç»Ÿä¸€æ¥å£
4. **å®æ—¶æ§åˆ¶**: ç¡¬å®æ—¶è°ƒåº¦å’Œé«˜é¢‘æ§åˆ¶å¾ªç¯
5. **çŠ¶æ€æœºæ¶æ„**: æ¸…æ™°çš„è¡Œä¸ºçŠ¶æ€ç®¡ç†
6. **æ­¥æ€ç®—æ³•**: æˆç†Ÿçš„æ‘†çº¿è½¨è¿¹ç”Ÿæˆ

è¿™ä¸ªæ–‡ä»¶ç»“æ„ä½“ç°äº†ä¸€ä¸ªæˆç†Ÿçš„å››è¶³æœºå™¨äººæ§åˆ¶æ¡†æ¶çš„è®¾è®¡æ€è·¯ï¼Œä¸ºç†è§£å’Œæ‰©å±•è¯¥ç³»ç»Ÿæä¾›äº†æ¸…æ™°çš„æ¨¡å—ç»„ç»‡ã€‚